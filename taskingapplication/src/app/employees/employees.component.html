<div class="main-container">
    <div class="floating-object floating-object-1"></div>
    <div class="floating-object floating-object-2"></div>
    <div class="floating-object floating-object-3"></div>
    <div class="floating-object floating-object-4"></div>
    <div class="floating-object floating-object-5"></div>
    <div class="floating-object floating-object-6"></div>
    <div class="floating-object floating-object-7"></div>
    <div class="floating-object floating-object-8"></div>
    <div class="floating-object floating-object-9"></div>
    <div class="floating-object floating-object-10"></div>
    <app-sidenav (hoverStateChanged)="onSidenavHover($event)"></app-sidenav>
    <div class="content">
        <h1>Employees</h1>

        <!-- Profile Container for Employees -->
        <div class="profile-container">
            <div class="profile-card" *ngFor="let user of users" (click)="openModal(user)">
                <div class="profile-image">
                    <img [src]="user.profile_picture || 'assets/default-profile.png'" alt="{{ user.fullname }}'s profile picture">
                </div>
                <div class="profile-details">
                    <h2>{{ user.fullname }}</h2>
                    <p><strong>Department:</strong> {{ user.department }}</p>
                </div>
            </div>
        </div>

        <!-- Modal for User Details -->
        <div *ngIf="modalVisible" class="modal-overlay">
            <div class="modal">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h2>{{ selectedUser?.fullname }}</h2>
                    <button (click)="closeModal()">X</button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <!-- Left Column: Assigned Tasks -->
                    <div class="left-column">
                        <h3>Assigned Tasks</h3>
                        <div *ngFor="let task of selectedUserTasks" class="task-card" (click)="openTaskModal(task)">
                            <div class="task-header">
                                <h4>{{ task.task_name }}</h4>
                                <span class="task-status" [ngClass]="getStatusClass(task.status)">
                                    {{ task.status }}
                                </span>
                            </div>
                            <div class="task-body">
                                <p><strong>Due Date:</strong> {{ task.due_date }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Uploaded Documents -->
                    <div class="document-container">
                        <h3>Uploaded Documents</h3>
                        <div *ngFor="let doc of selectedUserDocuments" class="document-card-container">
                            <div class="document-card">
                                <div class="document-header">
                                    <h4>{{ doc.filename }}</h4>
                                    <span class="document-type">{{ doc.docstype }}</span>
                                </div>
                                <div class="document-body">
                                    <p><strong>Upload Date:</strong> {{ doc.upload_date }}</p>
                                    <div class="document-actions">
                                        <!-- <button (click)="viewDocument(doc.filepath)" class="btn-view">View</button> -->
                                        <button (click)="downloadDocument(doc.id, doc.filename)" class="btn-download">Download</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Task Modal for Adding Comments and Task Files -->
                    <div *ngIf="taskModalVisible" class="modal-overlay">
                        <div class="modal">
                            <div class="modal-header">
                                <h2>Task: {{ selectedTask?.task_name }}</h2>
                                <button (click)="closeTaskModal()">X</button>
                            </div>

                            <div class="modal-body">
                                <!-- Add New Comment Section -->
                                <div class="new-comment-section">
                                    <h3>Add a Comment</h3>
                                    <textarea [(ngModel)]="newComment" rows="3" class="fixed-size" placeholder="Write your comment here"></textarea>
                                    <button (click)="submitComment()" [disabled]="!newComment.trim()">Submit</button>
                                </div>

                                <!-- Task Files Section -->
                                <div class="task-files-container">
                                    <h3>Submitted Task Files</h3>
                                    <div *ngFor="let file of selectedUserTaskFiles" class="task-file-card">
                                        <div class="task-file-header">
                                            <h4>{{ file.filename }}</h4>
                                            <span class="task-file-date">{{ file.upload_date }}</span>
                                        </div>
                                        <div class="task-file-body">
                                            <!-- <a [href]="file.filepath" target="_blank" class="btn-view">View</a> -->
                                            <button (click)="downloadTaskFile(file.id, file.filename)" class="btn-download">
                                                Download
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Fallback Messages -->
                    <div *ngIf="!selectedUserTasks || selectedUserTasks.length === 0">
                        <p>No tasks assigned yet.</p>
                    </div>
                    <div *ngIf="!selectedUserDocuments || selectedUserDocuments.length === 0">
                        <p>No documents uploaded yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
